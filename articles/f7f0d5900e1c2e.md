---
title: "mitmproxyみたいなやつをRustで作ったので学んだこと書く"
emoji: "🦀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["rust", "http", "hyper"]
published: false
---

# はじめに

Rustで[mitmproxy](https://mitmproxy.org/)みたいなやつを作れるライブラリを公開したのでそのときに学んだことを書きます。リポジトリはこちら。
https://github.com/hatoo/http-mitm-proxy

## mitmproxyとは

[mitmproxy](https://mitmproxy.org/)は、HTTPのプロキシサーバーで、HTTPSの通信の内容も見ることができるのが特徴です。

## HTTPプロキシ

HTTPプロキシはHTTPのレベルで動作するプロキシです。

ふつうのHTTP/1.1

```
❯ printf "GET / HTTP/1.1\r\nHost: example.com\r\nConnection: close\r\n\r\n" | nc example.com 80
HTTP/1.1 200 OK
Accept-Ranges: bytes
Age: 360610
Cache-Control: max-age=604800
Content-Type: text/html; charset=UTF-8
Date: Mon, 18 Nov 2024 06:44:56 GMT
Etag: "3147526947+gzip"
Expires: Mon, 25 Nov 2024 06:44:56 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT
Server: ECAcc (sac/256D)
Vary: Accept-Encoding
X-Cache: HIT
Content-Length: 1256
Connection: close

... # 以下Body (省略)
```

```
❯ printf "GET http://example.com/ HTTP/1.1\r\nHost: example.com\r\nConnection: close\r\n\r\n" | nc localhost 3003
HTTP/1.1 200 OK
Age: 302897
Cache-Control: max-age=604800
Content-Type: text/html; charset=UTF-8
Date: Mon, 18 Nov 2024 07:07:34 GMT
Etag: "3147526947+gzip+ident"
Expires: Mon, 25 Nov 2024 07:07:34 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT
Server: ECAcc (sac/251B)
Vary: Accept-Encoding
X-Cache: HIT
Content-Length: 1256
Connection: close

... # 以下Body (省略)
```