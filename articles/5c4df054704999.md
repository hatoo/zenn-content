---
title: "egglogå…¥é–€"
emoji: "ğŸ¥š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["egglog", "datalog", "egraph", "egg"]
published: false
---

# ã¯ã˜ã‚ã«

[egglog](https://github.com/egraphs-good/egglog)ã¯[Datalog](https://en.wikipedia.org/wiki/Datalog)ã£ã½ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã€[e-graph](https://en.wikipedia.org/wiki/E-graph)ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
æ±ç”¨çš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒ^[å¤šåˆ†ãƒãƒ¥ãƒ¼ãƒªãƒ³ã‚°å®Œå…¨ã§ã¯ã‚ã‚‹ã¨æ€ã†ãŒä¾‹ãˆã°webã‚µãƒ¼ãƒãƒ¼ã‚’æ›¸ãã¨ã„ã£ãŸã“ã¨ã«ã¯é©ã•ãªã„ã¨ã„ã†æ„å‘³]ã€æ•°å¼ã¨ã‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æœ€é©åŒ–ãŒå¾—æ„ã§[herbie](https://github.com/herbie-fp/herbie)ã§ã‚‚ä½¿ã‚ã‚ŒãŸã‚Šã—ã¦ã„ã¾ã™ã€‚

ã¨ã„ã£ã¦ã‚‚Datalogã‚‚e-graphã‚‚ãƒ”ãƒ³ã¨ã“ãªã„æ–¹ãŒã»ã¨ã‚“ã©ã ã¨æ€ã†ã®ã§ã€ãã“ã‚‰ã¸ã‚“ã‹ã‚‰èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

ä»¥ä¸‹ã«æœ¬è¨˜äº‹ã§å‡ºã¦ãã‚‹è¦ç´ ã‚’ã€ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼ã‚²ãƒ¼ãƒ ã«ã‚ˆãã‚ã‚‹ãƒ†ãƒƒã‚¯ãƒ„ãƒªãƒ¼é¢¨ã«å›³ã«ã—ã¦ã¿ã¾ã—ãŸã€‚


```mermaid
graph BT;
    Datalog --> egglog[egglog: ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ã‚„ã¤];
    Prolog -->|Prologã®ã‚µãƒ–ã‚»ãƒƒãƒˆ| Datalog;
    e-graph -->|e-graphã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª| egg;
    egg --> egglog;
    EqSat[EqSat: Equality Saturation] -->|EqSatã‚’åŠ¹ç‡çš„ã«å®Ÿè£…ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ | e-graph;
```

ä»¥ä¸‹ã¯ã‚°ãƒ©ãƒ•ã®2ç‚¹é–“ã®æœ€çŸ­è·é›¢ã‚’æ±‚ã‚ã‚‹egglogã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ã€‚
ã¡ãªã¿ã«ã“ã‚Œã ã‘ãªã‚‰åˆ¥ã«ã‚ã¡ã‚ƒã‚ã¡ã‚ƒæœ€é©ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã„ã†ã‚ã‘ã§ã‚‚ãªããã‚“ãªã«æœ‰ç”¨ã§ã¯ãªã„ã§ã™ãŒã€é›°å›²æ°—ã¯ã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚

```egglog:path.egg
; äºŒç‚¹é–“ã®è·é›¢ã‚’å®šç¾©ã™ã‚‹
(function edge (i64 i64) i64)
; äºŒç‚¹é–“ã®æœ€çŸ­è·é›¢
(function path (i64 i64) i64 :merge (min old new))

(rule ((= (edge x y) d))
    ((set (path x y) d)))

(rule ((= (path x y) d1) (= (edge y z) d2))
    ((set (path x z) (+ d1 d2))))

; è¾ºã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ã„ã
(set (edge 1 2) 1)
(set (edge 2 3) 2)
(set (edge 3 4) 3)
; EqSatå®Ÿè¡Œ
(run 3)
; 1-4é–“ã®æœ€çŸ­è·é›¢ã‚’å‡ºåŠ›
(query-extract (path 1 4))

; 1-4é–“ã«ã‚‚ã£ã¨çŸ­ã„çµŒè·¯ãŒã‚ã‚‹ã“ã¨ã‚’å…¥åŠ›
(set (edge 1 4) 5)

(run 3)

(query-extract (path 1 4))
(print-table path)
```